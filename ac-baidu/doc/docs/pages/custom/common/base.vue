<template>
  <div class="mb-4">
      <el-form :model="state" label-width="auto" style="max-width: 800px">
        <el-text class="mx-1" size="large" style="padding-bottom: 16px" tag="div">è°ƒè¯•é¡¹ï¼š</el-text>
        <el-form-item for="nothing" label="è„šæœ¬ç‰ˆæœ¬å·" label-position="left">
          <span style="margin-left: 18px">
            V{{ state.version }}
          </span>
        </el-form-item>
        <el-form-item for="nothing" label="å¼€å¯è°ƒè¯•æ—¥å¿—è¾“å‡º" label-position="left">
          <el-switch inline-prompt size="large" v-model="state.isDevMode" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
        </el-form-item>

        <el-form-item v-show="state.isDevMode" for="nothing" label="å¼€å¯æœ¬åœ°èµ„æºè°ƒè¯•æ¨¡å¼" label-position="left">
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="æ²¡äº‹åˆ«å¼€ï¼Œå¼€äº†å¿…å‡ºé—®é¢˜ï¼Œç”¨æ¥åŠ è½½ç›®æ ‡åœ°å€çš„æ ·å¼è¡¨çš„ï¼Œæ–¹ä¾¿è¿›è¡Œè°ƒè¯•-ä¸å¸¦ç¼“å­˜"
            placement="right"
          >
            <el-switch inline-prompt size="large" v-model="state.isLocalDevMode" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
          <el-input v-show="state.isLocalDevMode" v-model="state.localDebugBaseUrl" style="width: 400px; margin-left: 40px" placeholder="https://..." clearable @click.stop />
        </el-form-item>
        <el-text class="mx-1" size="large" style="padding-bottom: 16px" tag="div">å…¨å±€é¡¹ï¼š</el-text>
        <el-form-item for="nothing" label="âœˆé™„åŠ 0.æ˜¯å¦å¤„ç†é‡å®šå‘é—®é¢˜-æŒ‰éœ€å¼€å¯" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#redirect" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="é‡å®šå‘åŠŸèƒ½ï¼Œå»ºè®®å¼€å¯"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isRedirectEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ“µé™„åŠ 1-å»å¹¿å‘ŠåŠŸèƒ½" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#ads" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="å»å¹¿å‘ŠåŠŸèƒ½ï¼Œå»ºè®®å¼€å¯"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isAdsEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ™ƒé™„åŠ 2-è‡ªåŠ¨ç¿»é¡µ" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#pager" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="è‡ªåŠ¨ç¿»é¡µåŠŸèƒ½ï¼Œå»ºè®®å¼€å¯"
            placement="right"
          >
            <el-switch inline-prompt size="large" v-model="state.isAutopage" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ¶é™„åŠ 3-å¯ç”¨Favicon" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#favicon" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="æ˜¾ç¤ºFaviconåŠŸèƒ½ï¼Œå»ºè®®å¼€å¯"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isFaviconEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ“‘é™„åŠ 4-æ˜¾ç¤ºå³ä¾§æ " label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#remove-right" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="æ˜¾ç¤ºæœç´¢å³ä¾§æ ç»“æœï¼ŒæŒ‰éœ€å¼€å¯"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isRightDisplayEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ”é™„åŠ 5-ç¼–å·åŠŸèƒ½-å»ºè®®å…³é—­" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#number" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="ç¼–å·åŠŸèƒ½ï¼Œå»ºè®®å…³é—­"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isCounterEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
        <el-form-item for="nothing" label="ğŸ“‰é™„åŠ 6-ç§»é™¤æ–‡å­—ä¸‹åˆ’çº¿-å»ºè®®å¼€å¯" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#text-line" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="ç§»é™¤æ–‡å­—ä¸‹åˆ’çº¿ï¼Œå»ºè®®å¼€å¯"
            placement="right"
          >
             <el-switch inline-prompt size="large" v-model="state.isALineDisable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>

        <el-form-item for="nothing" label="ğŸ”³é™„åŠ 7-æš—é»‘ä¸»é¢˜è‰²-ã€æš—è‰²æ¨¡å¼å¼€å¯ã€‘" label-position="left">
          <a-tool-tip-icon href="/pages/home/use.html#darkmode" tooltipText="ç‚¹å‡»æŸ¥çœ‹è¯´æ˜" is="QuestionFilled"></a-tool-tip-icon>
          <el-tooltip
            class="box-item"
            effect="dark" :hide-after=20
            content="å¯ç”¨åï¼Œå°†æœç´¢ç»“æœé€‚é…ä¸ºæš—é»‘ä¸»é¢˜ï¼ŒæŒ‰éœ€å¼€å¯"
            placement="right"
          >
            <el-switch inline-prompt size="large" v-model="state.isDarkModeEnable" active-text="å¼€å¯" inactive-text="å…³é—­" style="margin-left: 15px;" />
          </el-tooltip>
        </el-form-item>
  
        <el-divider />
        <block-config :state="state" @update_state="updateState"/>
        
        <el-divider />
        <less-c-s-s-comp siteName="å…¬å…±" :baseItemKey="baseItemKey" :state="state" :recommendStyleList="recommendStyleList" @update_state="updateState"/>
      </el-form>
      <save-alert siteName="å…¬å…±" :saveKey="baseItemKey" :saveData="state" />  
    </div>
</template>
<script setup lang="ts">
import { reactive, watch } from "vue";
import SaveAlert from "./../components/SaveAlert.vue";
import BlockConfig from "./../components/BlockConfig.vue";
import AToolTipIcon from "./../components/AToolTipIcon.vue";
import LessCSSComp from "./../components/LessCSSComp/index.vue";

const baseItemKey = 'op_common'
// const baseData = JSON.parse(localStorage.getItem(baseItemKey) || '{}')
const baseData = {}
const scriptData = await safeFunc(() => window.AC_GM_Interface.get(baseItemKey, '{}'))

const base = reactive({
  bigImgShow: false,
  bigImgSrc: '',
  dialogWelcome: false,
  lessCompileRes: true,
  hasChanged: false,
})

const recommendStyleList = [
  {
    title: 'é»˜è®¤æ¨èæ ·å¼',
    description: 'æœ¬æ ·å¼ä¸ºä¸ªäººä¼˜åŒ–æ ·å¼ï¼Œå–åæ™´ç©ºï¼Œç‚¹å‡»æŸ¥çœ‹å¤§å›¾æ•ˆæœ',
    img: '',
    link: 'https://ibaidu.tujidu.com/newcss/dogeTwoPageStyle.less?t=23.6'
  }
]

const defaultOptions = {
  version: '',
  isDevMode: false,
  isLocalDevMode: false,
  localDebugBaseUrl: '',
  isRedirectEnable: false, // æ˜¯å¦å¼€å¯é‡å®šå‘åŠŸèƒ½
  isAdsEnable: false, // æ˜¯å¦å¼€å¯å»å¹¿å‘Šæ¨¡å¼
  isFaviconEnable: true, // æ˜¯å¦å¼€å¯Faviconå›¾æ ‡
  isAutopage: true, // æ˜¯å¦å¼€å¯è‡ªåŠ¨ç¿»é¡µåŠŸèƒ½

  isBlockEnable: true, // æ˜¯å¦å¼€å¯å»æ‹¦æˆªæ¨¡å¼
  isBlockResultDisplay: true, // æ˜¯å¦å‡½æ•°æ‹¦æˆªä¹‹åçš„å ä½
  isBlockBtnNotDisplay: false, // æ˜¯å¦æ˜¾ç¤ºblockæŒ‰é’®
  blockRuleList: [], // å·²ç»åŠ å…¥åˆ—è¡¨çš„æ‹¦æˆªè®°å½•

  isRightDisplayEnable: true, // æ˜¯å¦å¼€å¯å³ä¾§è¾¹æ 
  isCounterEnable: false, // æ˜¯å¦æ˜¾ç¤ºè®¡æ•°å™¨
  isALineDisable: false, // æ˜¯å¦ç¦æ­¢ä¸‹åˆ’çº¿
  isDarkModeEnable: false, // æ˜¯å¦å¯ç”¨æš—é»‘æ¨¡å¼

  commonStyleEnable: false, // è‡ªå®šä¹‰æ ·å¼-æ˜¯å¦å¯ç”¨
  commonStyleLink: '', // è‡ªå®šä¹‰æ ·å¼é“¾æ¥
  commonStyleLess: '', // è‡ªå®šä¹‰æ ·å¼é“¾æ¥
}
const state = reactive(Object.assign({}, defaultOptions, baseData, scriptData))

watch(state, (newVal) => {
  base.hasChanged = true
  safeFunc(() => {
    const keys = Object.keys(defaultOptions)
    const values = keys.map(one => state[one])
    const newOptions = Object.fromEntries(keys.map((key, index) => [key, values[index]]));
    AC_GM_Interface.change(baseItemKey, newOptions) // å±€éƒ¨æ›´æ–°ï¼šè°ƒç”¨GMæ¥å£ï¼šç”Ÿæ•ˆ && ä¿å­˜æ•°æ®ï¼Œå¹¶åˆ·æ–°åŸæœç´¢å¼•æ“é¡µé¢ï¼Œä»¥ä½¿è®¾ç½®ç”Ÿæ•ˆ
  })
})

insertVersion()

function insertVersion() {
  const version = document.querySelector('#é…ç½®é¡¹ .version-item')
  if (version) {
    version.remove()
  }
  document.querySelector('#é…ç½®é¡¹').insertAdjacentHTML('beforeend', `<span class="version-item">v${state.version}</span>`)
}

function safeFunc(callback, failed_res = '') {
  try{
    return callback()
  }catch(e){}
  return failed_res
}

function updateState(newVal) {
  base.hasChanged = true
  Object.assign(state, newVal)
}
</script>
<style lang="scss">
.el-form-item {
  padding-left: 30px;
}
</style>
